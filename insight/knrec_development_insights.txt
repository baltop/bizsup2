KNREC (한국신재생에너지센터) 스크래퍼 개발 인사이트
===========================================================

사이트 URL: https://www.knrec.or.kr/biz/pds/businoti/list.do
사이트 코드: knrec
개발 완료일: 2025-07-15

## 주요 기술적 특징

### 1. JavaScript 기반 파일 다운로드 시스템
- 사이트는 직접 파일 링크가 아닌 JavaScript 함수를 통한 파일 다운로드 방식 사용
- 파일 다운로드: `javascript:file_down('5763','1','notice')` 형태
- 파라미터: (게시글번호, 파일순번, 게시판타입)
- 정규표현식을 통한 파라미터 추출 필요: `file_down\('([^']+)','([^']+)','([^']+)'\)`

### 2. 복잡한 게시판 구조
- 메인 게시판 테이블: 두 번째 table 태그 사용
- 9개 컬럼: 번호, 상태, 분류, 제목, 담당부서, 등록일, 마감일, 첨부파일, 조회수
- 게시글 상세 페이지: `.notice_view_tit`, `.notice_view_txt` 클래스 사용

### 3. 첨부파일 처리 특징
- 첨부파일 링크 위치: `.add_file_btn a`, `.notive_view_file a`
- 한글 파일명 지원 완전 구현
- 파일명 정리 필요: "pdf파일", "한글파일", "(한글파일)" 등 제거
- 파일 크기 다양성: 163KB ~ 3.1MB (정상 다운로드 확인)

### 4. 듀얼 다운로드 접근 방식
- 1차 시도: Requests 라이브러리 (빠른 처리)
- 2차 시도: Playwright 브라우저 자동화 (JavaScript 실행)
- Requests 404 에러 발생 시 Playwright로 자동 대체

## 개발 과정에서의 주요 문제점과 해결책

### 문제 1: 게시글 목록 파싱 복잡성
**문제**: 복잡한 테이블 구조로 인한 파싱 어려움
**해결**: JavaScript 평가를 통한 동적 파싱
- `page.evaluate()` 사용하여 브라우저 내에서 직접 DOM 조작
- 테이블 구조 자동 감지 로직 구현

### 문제 2: JavaScript 파일 다운로드
**문제**: 직접 URL이 아닌 JavaScript 함수 호출 방식
**해결**: 파라미터 추출 및 브라우저 자동화
- 정규표현식으로 파라미터 추출
- Playwright로 JavaScript 함수 실행: `page.evaluate(f"file_down('{no}', '{file_seq}', '{board_type}')")`

### 문제 3: 한글 파일명 처리
**문제**: 한글 파일명 깨짐 및 불필요한 텍스트 포함
**해결**: UTF-8 인코딩 및 파일명 정리
- 파일명 정리: `fileName.replace(/pdf파일|한글파일|엑셀파일|zip파일|txt파일|워드파일/g, '').trim()`
- 안전한 파일명 생성: `re.sub(r'[<>:"/\\|?*]', '_', filename)`

### 문제 4: 파일 다운로드 실패 처리
**문제**: Requests로 직접 다운로드 시 404 에러 발생
**해결**: 이중 백업 시스템 구현
- 1차: `download_attachment_requests()` 시도
- 2차: `download_attachment_with_playwright()` 자동 대체

## 성능 및 안정성 개선사항

### 1. 요청 간격 조절
- 게시글 간 2초 대기
- 페이지 간 3초 대기
- 파일 다운로드 후 3초 대기

### 2. 오류 처리 강화
- HTML 페이지 응답 감지
- 파일 크기 검증 (1KB 미만 HTML 페이지 감지)
- 중복 파일 제거 로직

### 3. 메모리 효율성
- 각 게시글 처리 후 브라우저 인스턴스 정리
- 세션 재사용을 통한 네트워크 효율성 향상

## 결과 통계
- 총 처리 게시글: 10개 (테스트 진행 중)
- 성공적 첨부파일 다운로드: 6개
- 한글 파일명 지원: 완전 지원
- 파일 크기 다양성: 163KB ~ 3.1MB (정상)

## 권장사항
1. 정기적인 사이트 구조 변경 모니터링 필요
2. JavaScript 함수명 변경 가능성 대비
3. 파일 크기 임계값 조정 고려 (현재 1KB)
4. 추가 파일 형식 지원 확장 가능

## 기술 스택
- Python 3.x
- Playwright (브라우저 자동화)
- Requests (HTTP 통신)
- BeautifulSoup (HTML 파싱)
- html2text (마크다운 변환)
- 정규표현식 (파라미터 추출)