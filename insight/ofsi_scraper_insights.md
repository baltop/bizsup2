# OFSI 스크래퍼 개발 인사이트

## 사이트 정보
- **사이트명**: 전라남도 해양수산과학원 공지사항
- **URL**: https://ofsi.jeonnam.go.kr/ofsi/177/subview.do
- **사이트 코드**: ofsi

## 사이트 구조 분석

### 1. 페이지네이션 방식
- **방식**: POST 기반 페이지네이션
- **엔드포인트**: `/bbs/ofsi/38/artclList.do`
- **필수 파라미터**:
  ```python
  {
      'layout': 'YfvSWvlsyMjnrjh0KwMsxg%3D%3D',
      'menuNo': '37',
      'upperMenuNo': '37',
      'searchType': '',
      'searchWord': '',
      'page': '1'  # 페이지 번호
  }
  ```

### 2. 목록 페이지 구조
- **테이블 구조**: `table.artclTable` 클래스 사용
- **컬럼 순서**: 번호, 제목, 작성자, 작성일, 첨부파일, 조회수 (6개 컬럼)
- **공지사항 구분**: 번호 컬럼에 "일반공지" 텍스트로 구분
- **제목 링크**: `td` 내부의 `a` 태그에서 href 속성 추출

### 3. 상세 페이지 구조
- **본문 위치**: `div.content` 또는 `article` 태그 내부
- **첨부파일**: `dt:contains("첨부파일")` 다음 `dd` 태그에서 링크 추출
- **대체 첨부파일**: `a[href*="/download.do"]` 선택자로 다운로드 링크 탐지

## 기술적 특징

### 1. 세션 관리
- 정부 사이트 특성상 세션 유지 필요
- 초기 메인 페이지 방문으로 세션 초기화
- 다운로드 시 Referer 헤더 설정 필요

### 2. 한글 파일명 처리
- UTF-8 인코딩 완전 지원
- 한글 파일명 자동 처리 (예: `공고문(2025년_배합사료_구매자금_지원사업_추가사업자_모집).hwp`)
- 파일 크기 검증으로 오류 파일 감지

### 3. 파일 다운로드 검증
- Content-Type: text/html 감지로 오류 페이지 구분
- 1KB 미만 파일은 HTML 내용 검사
- 오류 파일 자동 삭제

## 성능 및 결과

### 수집 결과
- **총 페이지**: 3페이지
- **총 공고 수**: 33개
- **다운로드 파일**: 54개
- **중복 방지**: JSON 기반 해시 저장

### 파일 구조
```
output/ofsi/
├── processed_titles_enhancedofsi.json  # 중복 방지 데이터
├── 001_[일반공지]2025년_양식어가_배합사료_구매자금_지원사업_추가_사업자_모집/
│   ├── content.md
│   └── attachments/
│       └── 1._공고문(2025년_배합사료_구매자금_지원사업_추가사업자_모집).hwp
└── ... (32개 더)
```

## 개발 시 주의사항

### 1. POST 방식 페이지네이션
- GET 방식이 아닌 POST 방식 사용
- 폼 데이터 정확히 전송 필요
- 페이지 번호만 변경하여 요청

### 2. 정부 사이트 특성
- 세션 관리 필수
- 적절한 User-Agent 및 헤더 설정
- 요청 간격 조절 (1초 이상)

### 3. 파일 다운로드
- 다운로드 실패 시 HTML 응답 가능성
- 파일 크기 및 내용 검증 필요
- 한글 파일명 UTF-8 처리

### 4. 본문 내용 파싱
- `div.content` 우선 탐지
- 실패 시 `article` 태그 내용 추출
- HTML을 마크다운으로 변환

## 확장 가능성
- 더 많은 페이지 수집 시 `max_pages` 파라미터 조정
- 검색 기능 추가 시 `searchType`, `searchWord` 파라미터 활용
- 다른 게시판 수집 시 `menuNo`, `upperMenuNo` 파라미터 변경

## 트러블슈팅
- **세션 만료**: 초기화 후 재시도
- **파일 다운로드 실패**: HTML 응답 여부 확인
- **한글 깨짐**: UTF-8 인코딩 설정 확인
- **본문 내용 없음**: CSS 선택자 업데이트 필요

이 인사이트는 향후 OFSI 사이트 업데이트나 유사한 정부 사이트 스크래핑 시 참고할 수 있습니다.